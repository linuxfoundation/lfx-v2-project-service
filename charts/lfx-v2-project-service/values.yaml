# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT
---
# image is the configuration for the container images
image:
  # repository is the container image repository
  repository: ghcr.io/linuxfoundation/lfx-v2-project-service/project-api
  # tag is the container image tag (overrides appVersion from Chart.yaml)
  tag: ""
  # pullPolicy is the image pull policy
  pullPolicy: IfNotPresent

# initImage is the configuration for the init container image
initImage:
  # repository is the init container image repository
  repository: ghcr.io/linuxfoundation/lfx-v2-project-service/root-project-setup
  # tag is the init container image tag (overrides appVersion from Chart.yaml)
  tag: ""
  # pullPolicy is the init container image pull policy
  pullPolicy: IfNotPresent

# replicaCount is the number of replicas for the deployment
replicaCount: 3

# resources is the configuration for container resource limits and requests
resources:
  # limits is the maximum amount of resources the container can use
  limits:
    cpu: 500m
    memory: 512Mi
  # requests is the amount of resources the container requests
  requests:
    cpu: 100m
    memory: 128Mi

# app is the configuration for the application
app:
  # logLevel is the log level (debug, info, warn, error)
  logLevel: info
  # logAddSource is a boolean to determine if the log source should be added
  logAddSource: true
  # audience is the JWT audience required for this authentication with this app
  audience: lfx-v2-project-service
  # skipEtagValidation is a boolean to determine if the etag validation should be skipped
  # (only use for local development)
  skipEtagValidation: false
  # jwtAuthDisabledMockLocalPrincipal mocks auth for local development to use a set principal
  # (only use for local development)
  jwtAuthDisabledMockLocalPrincipal: ""
  # use_oidc_contextualizer is a boolean to determine if the OIDC contextualizer should be used
  use_oidc_contextualizer: true
  # extraEnv is a list of additional environment variables to set in the container.
  # Supports both simple key-value pairs and Kubernetes field references.
  extraEnv: []
  # otel is the configuration for OpenTelemetry tracing
  otel:
    # serviceName is the service name for OpenTelemetry resource identification
    # (default: "lfx-v2-project-service")
    serviceName: ""
    # serviceVersion is the service version for OpenTelemetry resource identification
    # (default: "1.0.0")
    serviceVersion: ""
    # protocol specifies the OTLP protocol: "grpc" or "http"
    # (default: "grpc")
    protocol: "grpc"
    # endpoint is the OTLP collector endpoint
    # For gRPC: typically "host:4317", for HTTP: typically "host:4318"
    endpoint: ""
    # insecure disables TLS for the OTLP connection
    # Set to "true" for in-cluster communication without TLS
    insecure: "false"
    # tracesExporter specifies the traces exporter: "otlp" or "none"
    # (default: "none")
    tracesExporter: "none"
    # tracesSampleRatio specifies the sampling ratio for traces (0.0 to 1.0)
    # A value of 1.0 means all traces are sampled, 0.5 means 50% are sampled
    # (default: "1.0")
    tracesSampleRatio: "1.0"
    # metricsExporter specifies the metrics exporter: "otlp" or "none"
    # (default: "none")
    metricsExporter: "none"
    # logsExporter specifies the logs exporter: "otlp" or "none"
    # (default: "none")
    logsExporter: "none"
    # propagators specifies the propagators to use, comma-separated
    # Supported values: "tracecontext", "baggage", "jaeger"
    # (default: "tracecontext,baggage")
    propagators: "tracecontext,baggage,jaeger"

# traefik is the configuration for Traefik Gateway API routing
traefik:
  # gateway specifies the platform Gateway to attach to
  gateway:
    name: lfx-platform-gateway
    namespace: lfx

# lfx is the configuration for LFX platform
lfx:
  # domain is the base domain for routing
  domain: k8s.orb.local
  # namespace is the target namespace for deployment
  namespace: lfx

# service is the configuration for the Kubernetes service
service:
  # port is the service port
  port: 8080

# rootProject is the configuration for the root project creation
rootProject:
  # writers is a list of users that should have writer access to the root project
  # Format options:
  # 1. Simple format (backward compatible): ["username1", "username2"]
  # 2. Structured format: ["username:name:email:avatar", "username2:name2:email2:avatar2"]
  writers:
    - "project_super_admin:Super Admin:super.admin@example.com:"
  # auditors is a list of users that should have auditor access to the root project
  # Format options:
  # 1. Simple format (backward compatible): ["username1", "username2"]
  # 2. Structured format: ["username:name:email:avatar", "username2:name2:email2:avatar2"]
  auditors:
    - "project_admin_1:Project Admin:project.admin@example.com:"

# nats is the configuration for the NATS server
nats:
  # url is the URL of the NATS server
  url: nats://lfx-platform-nats.lfx.svc.cluster.local:4222

  # kv_bucket_project_base is the configuration for the KV bucket for storing project base information
  kv_bucket_project_base:
    # creation is a boolean to determine if the KV bucket should be created via the helm chart.
    # set it to false if you want to use an existing KV bucket.
    creation: true
    # keep is a boolean to determine if the KV bucket should be preserved during helm uninstall
    # set it to false if you want the bucket to be deleted when the chart is uninstalled
    keep: true
    # name is the name of the KV bucket for storing project base information
    name: projects
    # history is the number of history entries to keep for the KV bucket
    history: 20
    # storage is the storage type for the KV bucket
    storage: file
    # maxValueSize is the maximum size of a value in the KV bucket
    maxValueSize: 10485760  # 10MB
    # maxBytes is the maximum number of bytes in the KV bucket
    maxBytes: 1073741824  # 1GB
    # compression is a boolean to determine if the KV bucket should be compressed
    compression: true

  # kv_bucket_project_settings is the configuration for the KV bucket for storing project settings
  kv_bucket_project_settings:
    # creation is a boolean to determine if the KV bucket should be created via the helm chart.
    # set it to false if you want to use an existing KV bucket.
    creation: true
    # keep is a boolean to determine if the KV bucket should be preserved during helm uninstall
    # set it to false if you want the bucket to be deleted when the chart is uninstalled
    keep: true
    # name is the name of the KV bucket for storing project settings
    name: project-settings
    # history is the number of history entries to keep for the KV bucket
    history: 20
    # storage is the storage type for the KV bucket
    storage: file
    # maxValueSize is the maximum size of a value in the KV bucket
    maxValueSize: 10485760  # 10MB
    # maxBytes is the maximum number of bytes in the KV bucket
    maxBytes: 1073741824  # 1GB
    # compression is a boolean to determine if the KV bucket should be compressed
    compression: true

# openfga is the configuration for the OpenFGA server
openfga:
  # enabled is a boolean to determine if the OpenFGA server should be enabled for authorization
  # Note: If it is disabled, then the project service will allow all requests
  # (Disabling OpenFGA should only be used for local development).
  enabled: true

# heimdall is the configuration for the heimdall middleware
heimdall:
  enabled: true
  url: http://lfx-platform-heimdall.lfx.svc.cluster.local:4456
  # jwksUrl is the JWKS URL for JWT verification (note: uses port 4457)
  jwksUrl: http://lfx-platform-heimdall.lfx.svc.cluster.local:4457/.well-known/jwks
  add_middleware: false
